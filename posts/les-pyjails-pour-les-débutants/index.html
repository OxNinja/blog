<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Les pyjails pour les débutants | 0xNinja - My blog</title><meta name=keywords content="ctf,jail,python"><meta name=description content="Introduction Tout d&rsquo;abord qu&rsquo;est-ce qu&rsquo;une &lsquo;pyjail&rsquo; ? Il s&rsquo;agit le plus souvent d&rsquo;un environnement Python 🐍 restreint, c&rsquo;est-à-dire que (comme pour les autres types de &lsquo;jails&rsquo;) certaines fonctions, classes ont été supprimées, ou sont filtrées lors du traitement de l&rsquo;input utilisateur pour bloquer l&rsquo;attaquant.
Ces environnements restreints sont présents lors de CTFs mais c&rsquo;est une catégorie qui nécessite un peu de connaissances avant de s&rsquo;y lancer, mais sont aussi utilisés dans des milieux professionnels afin d&rsquo;éviter de donner l&rsquo;accès à tout le système si un attaquant arrive à entrer sur un serveur SSH par exemple."><meta name=author content="0xNinja"><link rel=canonical href=https://0xninja.fr/posts/les-pyjails-pour-les-d%C3%A9butants/><link crossorigin=anonymous href=/assets/css/stylesheet.min.ba88f41f11a10b879278bfa0e5f4846fcc23eb1705121ab38cfd85f1b1749b7f.css integrity="sha256-uoj0HxGhC4eSeL+g5fSEb8wj6xcFEhqzjP2F8bF0m38=" rel="preload stylesheet" as=style><link rel=icon href=https://0xninja.fr/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://0xninja.fr/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://0xninja.fr/favicon-32x32.png><link rel=apple-touch-icon href=https://0xninja.fr/apple-touch-icon.png><link rel=mask-icon href=https://0xninja.fr/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.79.1"><meta property="og:title" content="Les pyjails pour les débutants"><meta property="og:description" content="Introduction Tout d&rsquo;abord qu&rsquo;est-ce qu&rsquo;une &lsquo;pyjail&rsquo; ? Il s&rsquo;agit le plus souvent d&rsquo;un environnement Python 🐍 restreint, c&rsquo;est-à-dire que (comme pour les autres types de &lsquo;jails&rsquo;) certaines fonctions, classes ont été supprimées, ou sont filtrées lors du traitement de l&rsquo;input utilisateur pour bloquer l&rsquo;attaquant.
Ces environnements restreints sont présents lors de CTFs mais c&rsquo;est une catégorie qui nécessite un peu de connaissances avant de s&rsquo;y lancer, mais sont aussi utilisés dans des milieux professionnels afin d&rsquo;éviter de donner l&rsquo;accès à tout le système si un attaquant arrive à entrer sur un serveur SSH par exemple."><meta property="og:type" content="article"><meta property="og:url" content="https://0xninja.fr/posts/les-pyjails-pour-les-d%C3%A9butants/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-03-09T18:30:00+00:00"><meta property="article:modified_time" content="2019-03-09T18:30:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Les pyjails pour les débutants"><meta name=twitter:description content="Introduction Tout d&rsquo;abord qu&rsquo;est-ce qu&rsquo;une &lsquo;pyjail&rsquo; ? Il s&rsquo;agit le plus souvent d&rsquo;un environnement Python 🐍 restreint, c&rsquo;est-à-dire que (comme pour les autres types de &lsquo;jails&rsquo;) certaines fonctions, classes ont été supprimées, ou sont filtrées lors du traitement de l&rsquo;input utilisateur pour bloquer l&rsquo;attaquant.
Ces environnements restreints sont présents lors de CTFs mais c&rsquo;est une catégorie qui nécessite un peu de connaissances avant de s&rsquo;y lancer, mais sont aussi utilisés dans des milieux professionnels afin d&rsquo;éviter de donner l&rsquo;accès à tout le système si un attaquant arrive à entrer sur un serveur SSH par exemple."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://0xninja.fr/posts/"},{"@type":"ListItem","position":3,"name":"Les pyjails pour les débutants","item":"https://0xninja.fr/posts/les-pyjails-pour-les-d%C3%A9butants/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Les pyjails pour les débutants","name":"Les pyjails pour les débutants","description":"Introduction Tout d\u0026rsquo;abord qu\u0026rsquo;est-ce qu\u0026rsquo;une \u0026lsquo;pyjail\u0026rsquo; ? Il s\u0026rsquo;agit le plus souvent d\u0026rsquo;un environnement Python 🐍 restreint, c\u0026rsquo;est-à-dire que (comme pour les autres types de \u0026lsquo;jails\u0026rsquo;) certaines fonctions, classes ont été supprimées, ou sont filtrées lors du traitement de l\u0026rsquo;input utilisateur pour bloquer l\u0026rsquo;attaquant.\nCes environnements restreints sont présents lors de CTFs mais c\u0026rsquo;est une catégorie qui nécessite un peu de connaissances avant de s\u0026rsquo;y lancer, mais sont aussi utilisés dans des milieux professionnels afin d\u0026rsquo;éviter de donner l\u0026rsquo;accès à tout le système si un attaquant arrive à entrer sur un serveur SSH par exemple.","keywords":["ctf","jail","python"],"articleBody":"Introduction Tout d’abord qu’est-ce qu’une ‘pyjail’ ? Il s’agit le plus souvent d’un environnement Python 🐍 restreint, c’est-à-dire que (comme pour les autres types de ‘jails’) certaines fonctions, classes ont été supprimées, ou sont filtrées lors du traitement de l’input utilisateur pour bloquer l’attaquant.\nCes environnements restreints sont présents lors de CTFs mais c’est une catégorie qui nécessite un peu de connaissances avant de s’y lancer, mais sont aussi utilisés dans des milieux professionnels afin d’éviter de donner l’accès à tout le système si un attaquant arrive à entrer sur un serveur SSH par exemple.\nUn peu de pratique Avec l’aide d’un cobaye pour le test, qui se reconnaîtra, j’ai réalisé quelques pyjails qui permettent de mieux appréhender le langage Python, mais aussi de développer une méthodologie de résolution.\nNous allons voir comment résoudre une jail des plus basiques ensemble, ensuite vous serez libres d’approfondir vos connaissances avec d’autres jails que j’ai réalisé, et si le cœur vous en dit vous pouvez même tenter de flag les jails sur Root-Me 😊.\nAvant de commencer Vérifiez bien d’avoir Python 3 d’installé sur votre machine, puis téléchargez cette archive zip qui contient l’environnement de travail adéquat pour résoudre toutes les jails. Cette archive contient un fichier flag.txt qui est lu par toutes les jails lorsque vous avez réussi le challenge, vous devez alors laisser les fichiers jail*.py dans le même dossier.\nPour démarrer Au préalable, décompressez le fichier zip :\n1  mkdir jails; unzip jails.zip -d jails/; cd jails   Pour lancer une jail de votre choix vous avez simplement à l’exécuter avec Python :\n1  python3 jail1.py    Note : les jails sont classées par difficulté croissante, on a alors jail1 plus simple que jail3\n Au boulot ! Passons à la réalisation de la jail 1. Le but est de finir le challenge sans lire le code source du fichier, mais si vous êtes bloqué plusieurs heures n’hésitez pas à y jeter un coup d’œil rapide.\nPremier lançement Pour nous échapper de cette prison nous allons devoir étudier comment fonctionne le programme. On lance la jail1 :\nTests Effectuons quelques tests afin de déterminer ce que l’on peut faire dans cet environement restreint :\nOn peut voir que les opérations usuelles (calculs, affichage, variables…) sont autorisées, essayons sd’appeler la méthode flag() afin de sortir :\nPas de chance, rien ne se passe, pourtant on voit bien que flag est une fonction, on devrait être en mesure de l’apeller, comme pour print() par exemple.\nIl doit se passer quelque chose entre le moment où l’on entre la commande et l’exécution de cette dernière 😔.\nEssayons de déterminer le problème :\nRésolution On comprend alors que l’entrée utilisateur est filtrée : si la chaîne \"flag()\" est présente, elle est supprimée. Comment y remédier ?\nIl existe une astuce moldave bien connue pour contourner ce filtre, vous connaissez le film Inception ? C’est le même principe, sauf que c’est pas dans un rêve mais un shell Python.\nEn effet, écrire fflag()lag(), ou flag(flag()), ou toute autre variation permet de contourner le filtre. 🎉🎉\n","wordCount":"507","inLanguage":"en","datePublished":"2019-03-09T18:30:00Z","dateModified":"2019-03-09T18:30:00Z","author":{"@type":"Person","name":"0xNinja"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://0xninja.fr/posts/les-pyjails-pour-les-d%C3%A9butants/"},"publisher":{"@type":"Organization","name":"0xNinja - My blog","logo":{"@type":"ImageObject","url":"https://0xninja.fr/favicon.ico"}}}</script></head><body id=top><script>if(localStorage.getItem("pref-theme")==="dark"){document.body.classList.add('dark');}else if(localStorage.getItem("pref-theme")==="light"){document.body.classList.remove('dark')}else if(window.matchMedia('(prefers-color-scheme: dark)').matches){document.body.classList.add('dark');}</script><noscript><style type=text/css>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme: #1d1e20;--entry: #2e2e33;--primary: rgba(255, 255, 255, 0.84);--secondary: rgba(255, 255, 255, 0.56);--tertiary: rgba(255, 255, 255, 0.16);--content: rgba(255, 255, 255, 0.74);--hljs-bg: #2e2e33;--code-bg: #37383e;--border: #333}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><header class=header><nav class=nav><div class=logo><a href=https://0xninja.fr accesskey=h title="0xNinja - My blog (Alt + H)">0xNinja - My blog</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://0xninja.fr/about/ title="🥷 About"><span>🥷 About</span></a></li><li><a href=https://0xninja.fr/archives/ title="📝 Archives"><span>📝 Archives</span></a></li><li><a href=https://0xninja.fr/tags/ title="🏷️ Tags"><span>🏷️ Tags</span></a></li><li><a href=https://0xninja.fr/projects/ title="🔬 Projects"><span>🔬 Projects</span></a></li><li><a href=https://0xninja.fr/search/ title="🔎 Search (Alt + /)" accesskey=/><span>🔎 Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Les pyjails pour les débutants</h1><div class=post-meta>March 9, 2019&nbsp;·&nbsp;0xNinja</div></header><div class=post-content><h2 id=introduction>Introduction<a hidden class=anchor aria-hidden=true href=#introduction>#</a></h2><p>Tout d&rsquo;abord qu&rsquo;est-ce qu&rsquo;une &lsquo;pyjail&rsquo; ? Il s&rsquo;agit le plus souvent d&rsquo;un environnement Python 🐍 restreint, c&rsquo;est-à-dire que (comme pour les autres types de &lsquo;jails&rsquo;) certaines fonctions, classes ont été supprimées, ou sont filtrées lors du traitement de l&rsquo;input utilisateur pour bloquer l&rsquo;attaquant.</p><p>Ces environnements restreints sont présents lors de CTFs mais c&rsquo;est une catégorie qui nécessite un peu de connaissances avant de s&rsquo;y lancer, mais sont aussi utilisés dans des milieux professionnels afin d&rsquo;éviter de donner l&rsquo;accès à tout le système si un attaquant arrive à entrer sur un serveur SSH par exemple.</p><h2 id=un-peu-de-pratique>Un peu de pratique<a hidden class=anchor aria-hidden=true href=#un-peu-de-pratique>#</a></h2><p>Avec l&rsquo;aide d&rsquo;un cobaye pour le test, qui se reconnaîtra, j&rsquo;ai réalisé quelques pyjails qui permettent de mieux appréhender le langage Python, mais aussi de développer une méthodologie de résolution.</p><p>Nous allons voir comment résoudre une jail des plus basiques ensemble, ensuite vous serez libres d’approfondir vos connaissances avec d&rsquo;autres jails que j&rsquo;ai réalisé, et si le cœur vous en dit vous pouvez même tenter de flag les jails sur Root-Me 😊.</p><h3 id=avant-de-commencer>Avant de commencer<a hidden class=anchor aria-hidden=true href=#avant-de-commencer>#</a></h3><p>Vérifiez bien d&rsquo;avoir Python 3 d&rsquo;installé sur votre machine, puis téléchargez <a href=jails.zip>cette archive zip</a> qui contient l&rsquo;environnement de travail adéquat pour résoudre toutes les jails. Cette archive contient un fichier <code>flag.txt</code> qui est lu par toutes les jails lorsque vous avez réussi le challenge, vous devez alors laisser les fichiers <code>jail*.py</code> dans le même dossier.</p><h3 id=pour-démarrer>Pour démarrer<a hidden class=anchor aria-hidden=true href=#pour-démarrer>#</a></h3><p>Au préalable, décompressez le fichier zip :</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>mkdir jails; unzip jails.zip -d jails/; cd jails
</code></pre></td></tr></table></div></div><p>Pour lancer une jail de votre choix vous avez simplement à l&rsquo;exécuter avec Python :</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>python3 jail1.py
</code></pre></td></tr></table></div></div><blockquote><p>Note : les jails sont classées par difficulté croissante, on a alors <code>jail1</code> plus simple que <code>jail3</code></p></blockquote><h3 id=au-boulot->Au boulot !<a hidden class=anchor aria-hidden=true href=#au-boulot->#</a></h3><p>Passons à la réalisation de la jail 1. Le but est de finir le challenge sans lire le code source du fichier, mais si vous êtes bloqué plusieurs heures n&rsquo;hésitez pas à y jeter un coup d’œil rapide.</p><h4 id=premier-lançement>Premier lançement<a hidden class=anchor aria-hidden=true href=#premier-lançement>#</a></h4><p>Pour nous échapper de cette prison nous allons devoir étudier comment fonctionne le programme. On lance la jail1 :</p><p><img loading=lazy src=launch.png alt="Lançement de la jail1 dans l&amp;rsquo;invite de commande"></p><h4 id=tests>Tests<a hidden class=anchor aria-hidden=true href=#tests>#</a></h4><p>Effectuons quelques tests afin de déterminer ce que l&rsquo;on peut faire dans cet environement restreint :</p><p><img loading=lazy src=tests.png alt="Premiers tests"></p><p>On peut voir que les opérations usuelles (calculs, affichage, variables&mldr;) sont autorisées, essayons sd&rsquo;appeler la méthode <code>flag()</code> afin de sortir :</p><p><img loading=lazy src=tests2.png alt="Appel de la méthode flag"></p><p>Pas de chance, rien ne se passe, pourtant on voit bien que <code>flag</code> est une fonction, on devrait être en mesure de l&rsquo;apeller, comme pour <code>print()</code> par exemple.</p><p>Il doit se passer quelque chose entre le moment où l&rsquo;on entre la commande et l&rsquo;exécution de cette dernière 😔.</p><p>Essayons de déterminer le problème :</p><p><img loading=lazy src=tests3.png alt="Différents tests"></p><h4 id=résolution>Résolution<a hidden class=anchor aria-hidden=true href=#résolution>#</a></h4><p>On comprend alors que l&rsquo;entrée utilisateur est filtrée : si la chaîne <code>"flag()"</code> est présente, elle est supprimée. Comment y remédier ?</p><p>Il existe une astuce moldave bien connue pour contourner ce filtre, vous connaissez le film <em>Inception</em> ? C&rsquo;est le même principe, sauf que c&rsquo;est pas dans un rêve mais un shell Python.</p><p><img loading=lazy src=tests4.png alt="Contournement moldave"></p><p>En effet, écrire <code>fflag()lag()</code>, ou <code>flag(flag())</code>, ou toute autre variation permet de contourner le filtre. 🎉🎉</p><p><img loading=lazy src=finish.png alt="Résolution de la pyjail"></p><p><img loading=lazy src=https://media.giphy.com/media/l0OWistc2HUjf6PKM/giphy.gif alt="Jail escape gif"></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://0xninja.fr/tags/ctf/>ctf</a></li><li><a href=https://0xninja.fr/tags/jail/>jail</a></li><li><a href=https://0xninja.fr/tags/python/>python</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2021 <a href=https://0xninja.fr>0xNinja - My blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></button></a>
<script>let menu=document.getElementById('menu')
menu.scrollLeft=localStorage.getItem("menu-scroll-position");menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft);}
document.querySelectorAll('a[href^="#"]').forEach(anchor=>{anchor.addEventListener("click",function(e){e.preventDefault();var id=this.getAttribute("href").substr(1);if(!window.matchMedia('(prefers-reduced-motion: reduce)').matches){document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({behavior:"smooth"});}else{document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();}
if(id==="top"){history.replaceState(null,null," ");}else{history.pushState(null,null,`#${id}`);}});});</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){if(document.body.scrollTop>800||document.documentElement.scrollTop>800){mybutton.style.visibility="visible";mybutton.style.opacity="1";}else{mybutton.style.visibility="hidden";mybutton.style.opacity="0";}};</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{if(document.body.className.includes("dark")){document.body.classList.remove('dark');localStorage.setItem("pref-theme",'light');}else{document.body.classList.add('dark');localStorage.setItem("pref-theme",'dark');}})</script><script>document.querySelectorAll('pre > code').forEach((codeblock)=>{const container=codeblock.parentNode.parentNode;const copybutton=document.createElement('button');copybutton.classList.add('copy-code');copybutton.innerText='copy';function copyingDone(){copybutton.innerText='copied!';setTimeout(()=>{copybutton.innerText='copy';},2000);}
copybutton.addEventListener('click',(cb)=>{if('clipboard'in navigator){navigator.clipboard.writeText(codeblock.textContent);copyingDone();return;}
const range=document.createRange();range.selectNodeContents(codeblock);const selection=window.getSelection();selection.removeAllRanges();selection.addRange(range);try{document.execCommand('copy');copyingDone();}catch(e){};selection.removeRange(range);});if(container.classList.contains("highlight")){container.appendChild(copybutton);}else if(container.parentNode.firstChild==container){}else if(codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"){codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);}else{codeblock.parentNode.appendChild(copybutton);}});</script></body></html>